tosca_definitions_version: tosca_simple_yaml_1_2
description: This version of the example given TR255C 17.5.0 conformant to TOSCA simple profile 1.2 

repositories:
  tmforum:
    description: >-
      URL where TMForum publishes SID in TOSCA format
    url: https://www.tmforum.org/resources/standard/information-framework-sid-release-xx-x-tosca-format/
    credential:
      user: member
      token: password


imports:
  - file: ../sid.yml
  # would normally refer to external repository but for now it is local so comment it out
  # - repository: tmforum

artifact_types:
  tosca.artifacts.Deployment.Image.VM.QCOW2:
    derived_from: tosca.artifacts.Deployment.Image.VM
    description: QCOW2 format

node_types:
  org.tmforum.tr255c.nodes.firewall:
    derived_from: tosca.nodes.org.tmforum.models.sidmodels.ResourceDomain.ResourceABE.CompoundResourceABE.CompoundResource
    properties:
      operating_system:
        type: string
    attributes:
      max_traffic_processed_GBs_per_sec:
        type: integer
    requirements:
      - core_software:
          capability: tosca.capabilities.Root
          node: tosca.nodes.SoftwareComponent.networked
          relationship: DependsOn
    capabilities:
      CP1: Endpoint
      CP14: Endpoint

  tosca.nodes.SoftwareComponent.networked:
    derived_from: tosca.nodes.SoftwareComponent
    description: A software component with ports
    requirements:
    - port:
        capability: tosca.capabilities.network.Bindable
        node: tosca.nodes.network.Port
        relationship: tosca.relationships.network.BindsTo
    capabilities:
      externalconnection: 
        type: tosca.capabilities.Endpoint
        description: External connection endpoint

topology_template:
  description: Virtual Firewall as described in TR255C

  node_templates:
    my_virtualFirewall:
      type: org.tmforum.tr255c.nodes.firewall
      properties:
        operating_system: { get_input: os_type  }
      requirements:
        - core_software: 
            node: SWI1

    SWI1:
      type: tosca.nodes.SoftwareComponent.networked
      properties:
        component_version: 1.0
        admin_credential:
          user: myusername
          token: mypassword
      requirements:
        - host:
            node: tosca.nodes.Compute
            node_filter:
              properties:
                disk_size: 
                  - greater_or_equal: 10 GB
                num_cpus: 
                  - greater_or_equal: 2
                mem_size: 
                  - greater_or_equal: 4 GB
              capabilities:
                os:
                  properties:
                    type: 
                      - equal: { get_property: my_virtualFirewall, operating_system }
        - port: CP2
      interfaces:
        Standard:
            create: my_vm_image
      artifacts:
        my_vm_image:
          file: images/fedora-18-x86_64.qcow2
          type: tosca.artifacts.Deployment.Image.VM.QCOW2

    CP2:
      type: tosca.nodes.network.Port